<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <link rel="stylesheet" type="text/css" href="${static_url}/css/common.css" /><link rel="stylesheet" href="${static_url}/css/depot.css" /><link rel="stylesheet" href="${static_url}/js/jquery-ui/jquery-ui-1.9.2.css"><title>OA系统用户表</title></head><body class="module_manage">	<div class="list_header">		<div class="title">			<span>OA用户表</span>		</div>		<div class="action">			<a href="javascript:addUser()">+注册用户</a>		</div>	</div>	<div class="list_condition_nav">		<form action="${base_url}/UserAdmin/show" method="post" name="queryUserForm">		<span>用户名&nbsp;<input type="text" name="userName" class="wdith100" value="${queryOptions.userName!}"></input></span>		<span><input type="submit" value="查询" /></span>		</form>	</div>	<div class="list_containter">		<table id="batch-table" >			<tr id="batch-table-header">				<th>登录名称</th>				<th>姓名</th>				<th>密码(加密)</th>				<th>创建时间</th>				<th>最近修改时间</th>				<th>操作</th>			</tr>			<#list userList.pageRecords as user>	  			<tr id="user_${user.userId?c}"<#if (user_index+1)%2 == 0>class="even"<#else>class="odd"</#if>>				<td>${user.userName!}</td>				<td>${user.userNickName!}</td>				<td>${user.userPassword!}</td>				<td>${fromUnixTimestamp(user.createTimestamp)}</td>				<td>${fromUnixTimestamp(user.lastmofiyTimestamp)}</td>				<td class="action">					<span>						<a href="javascript:updateUser(${user.userId?c})">更新</a>					</span>				</td>			</tr>			</#list>		</table>	</div>			<div>		<#import "/pager.ftl" as q>  		<#if userList.totalCount??>  		<@q.pager pageNo=pageIndex pageSize=pageSize recordCount=userList.totalCount toURL=toUrl />  		</#if>	</div>		<!-- dialog -->	<div id="dialog-form">		<form id="userForm">			<input type="hidden" id="userIdInput" name="userId" value="" />			<fieldset>				<label>登录用户名</label>				<input type="text" id="userNameInput" name="userName" class="text ui-widget-content ui-corner-all">				<br/><br/>				<label>姓名</label>				<input type="text" id="userNickNameInput" name="userNickName" class="text ui-widget-content ui-corner-all">				<br/><br/>				<div id="password"></div>			</fieldset>		</form>	</div></body><script type="text/javascript" src="${static_url}/js/jquery-1.7.2.min.js"></script><script type="text/javascript" src="${static_url}/js/jquery-ui/jquery-ui-1.9.2.js"></script><script>function openDialog() {	$('#dialog-form').dialog('open');}function closeDialog() {	$('#dialog-form').dialog('close');}function addUser() {	$('#userForm')[0].reset();	$('#userIdInput').val('');	$('#userNameInput').removeAttr('disabled');	$('#dialog-form').dialog("option", "title", "注册用户");	$('#password').html('<label>默认密码为${defaultPassword}</label>');	openDialog();}function getRowValue(row, index) {	return row.children('td').eq(index).html();}function updateUser(userId) {	var selectRow = $('#user_' + userId);	$('#userIdInput').val(userId);	$('#userNameInput').val(getRowValue(selectRow, 0)).attr('disabled', 'disabled');	$('#userNickNameInput').val(getRowValue(selectRow, 1));	$('#password').html(		'<label for="password">密码(为空表示不修改):</label><input type="password" id="userPasswordInput" name="userPassword" class="text ui-widget-content ui-corner-all">');		$('#dialog-form').dialog("option", "title", "更新用户");	openDialog();}function showMsg(msg) {	alert(msg);}function doAddUser() {	var userName = $('#userNameInput').val();	var userNickName = $('#userNickNameInput').val();		if (userName == ""){		showMsg('请输入用户登录名');		return ;	}	if (userNickName == "") {		showMsg('请输入用户姓名');		return ;	}		$.ajax({        type : "POST",        dataType : "json",        timeout : 10000,        data : {        	userName : userName,        	userNickName : userNickName,        },        url : "${base_url}/UserAdmin/register",        async : true,      	success : function(msg){        	if (msg.errorCode == 0) {            	window.location.href="${base_url}/UserAdmin/show?userName=" + encodeURI(userName);            	closeDialog();       		} else {            	showMsg(msg.errorMsg);        	}        },       error : function(request, textStatus, errorThrown) {	   		if (request.status >= 500 || request.status == 404) {				showMsg('服务器繁忙，请重试');			} else if (request.status != 0) {				showMsg('连接服务器失败, 请检查网络');			}       }    });}function doUpdateUser() {	var userNickName = $('#userNickNameInput').val();	var userPassword = $('#userPasswordInput').val();	var userId = $('#userIdInput').val();		$.ajax({        type : "POST",        dataType : "json",        timeout : 10000,        data : {        	userId : userId,        	userNickName : userNickName,        	userPassword : userPassword        },        url : "${base_url}/UserAdmin/updateUser",        async : true,      	success : function(msg) {        	if (msg.errorCode == 0) {            	window.location.href="${base_url}/UserAdmin/show?userId=" + userId;            	closeDialog();       		} else {            	showMsg(msg.errorMsg);        	}        },       error : function(request, textStatus, errorThrown) {	   		if (request.status >= 500 || request.status == 404) {				showMsg('服务器繁忙，请重试');			} else if (request.status != 0) {				showMsg('连接服务器失败, 请检查网络');			}       }    });	}$(document).ready(function(){	$('#dialog-form').dialog({			autoOpen : false,			height : 330,			width : 350,			modal : true,			buttons : {				'提交' : function() {					if ("" == $('#userIdInput').val()) {						doAddUser();					} else {						doUpdateUser();					}				},				'取消' : function() {					closeDialog();				}			}	});});</script></html>